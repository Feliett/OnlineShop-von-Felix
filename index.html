<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Onlineshop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- ðŸ”¹ HEADER MIT NAVIGATION -->
    <header>
        <h1 id="logo">Mein Onlineshop</h1>
        <nav>
            <ul>
                <li><a href="#" onclick="loadProducts('all')">Alle Produkte</a></li>
                <li><a href="#" onclick="loadProducts('Bekleidung')">Bekleidung</a></li>
                <li><a href="#" onclick="loadProducts('Schuhe')">Schuhe</a></li>
                <li><a href="#" onclick="loadProducts('Schmuck')">Schmuck</a></li>
                <li><a href="#" onclick="openCart()">ðŸ›’ Warenkorb <span id="cart-count">0</span></a></li>
                <li><a href="#" onclick="openLogin()">ðŸ‘¤ Login</a></li>
            </ul>
        </nav>
    </header>

    <!-- ðŸ”¹ PRODUKTLISTE -->
    <section id="products-container">
        <h2>Produkte</h2>
        <div class="grid-container" id="product-list"></div>
    </section>

    <!-- ðŸ”¹ WARENKORB -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCart()">&times;</span>
            <h2>Dein Warenkorb</h2>
            <div id="cart-items"></div>
            <p>Gesamt: <span id="cart-total">0,00 â‚¬</span></p>
            <button onclick="checkout()">Bezahlen</button>
        </div>
    </div>

    <!-- ðŸ”¹ LOGIN/REGISTRIERUNG -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLogin()">&times;</span>
            <h2>Login / Registrierung</h2>
            <input type="email" id="email" placeholder="E-Mail">
            <input type="password" id="password" placeholder="Passwort">
            <button onclick="login()">Login</button>
            <button onclick="register()">Registrieren</button>
        </div>
    </div>

    <!-- ðŸ”¹ SCRIPTS -->
    <script>
        const API_BASE_URL = "https://extra-peer-rich-demonstrate.trycloudflare.com/api";
        let cart = [];

        // ðŸ”¹ PRODUKTE LADEN
        async function loadProducts(category = "all") {
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                const products = await response.json();
                const productList = document.getElementById("product-list");
                productList.innerHTML = "";
                
                products.forEach(product => {
                    if (category === "all" || product.category === category) {
                        productList.innerHTML += `
                            <div class="product">
                                <img src="${product.image}" alt="${product.name}">
                                <h3>${product.name}</h3>
                                <p>${product.price} â‚¬</p>
                                <button onclick="addToCart(${product._id}, '${product.name}', ${product.price})">In den Warenkorb</button>
                            </div>
                        `;
                    }
                });
            } catch (error) {
                console.error("Fehler beim Laden der Produkte:", error);
            }
        }

        // ðŸ”¹ PRODUKT ZUM WARENKORB HINZUFÃœGEN
        function addToCart(id, name, price) {
            const item = cart.find(p => p.id === id);
            if (item) {
                item.quantity++;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            updateCart();
        }

        // ðŸ”¹ WARENKORB AKTUALISIEREN
        function updateCart() {
            const cartCount = document.getElementById("cart-count");
            cartCount.innerText = cart.length;

            const cartItems = document.getElementById("cart-items");
            const cartTotal = document.getElementById("cart-total");

            cartItems.innerHTML = "";
            let total = 0;

            cart.forEach(item => {
                total += item.price * item.quantity;
                cartItems.innerHTML += `
                    <div class="cart-item">
                        <p>${item.name} x ${item.quantity} - ${item.price * item.quantity} â‚¬</p>
                        <button onclick="removeFromCart(${item.id})">ðŸ—‘</button>
                    </div>
                `;
            });

            cartTotal.innerText = `${total.toFixed(2)} â‚¬`;
        }

        // ðŸ”¹ WARENKORB Ã–FFNEN/SCHLIEÃŸEN
        function openCart() { document.getElementById("cart-modal").style.display = "block"; }
        function closeCart() { document.getElementById("cart-modal").style.display = "none"; }

        // ðŸ”¹ LOGIN-FUNKTION
        async function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            const response = await fetch(`${API_BASE_URL}/auth/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();
            if (data.token) {
                localStorage.setItem("token", data.token);
                alert("Login erfolgreich!");
                closeLogin();
            } else {
                alert("Fehler: " + data.msg);
            }
        }

        // ðŸ”¹ REGISTRIERUNG
        async function register() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            const response = await fetch(`${API_BASE_URL}/auth/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();
            if (data.token) {
                localStorage.setItem("token", data.token);
                alert("Registrierung erfolgreich!");
                closeLogin();
            } else {
                alert("Fehler: " + data.msg);
            }
        }

        // ðŸ”¹ MODALE FENSTER
        function openLogin() { document.getElementById("login-modal").style.display = "block"; }
        function closeLogin() { document.getElementById("login-modal").style.display = "none"; }

        // ðŸ”¹ INITIAL PRODUKTE LADEN
        loadProducts();
    </script>

</body>
</html>
